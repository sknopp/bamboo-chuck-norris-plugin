sudo: false
language: java
jdk:
  - oraclejdk8
dist: trusty
env:
  global:
    - MOZ_HEADLESS=1
    - MAVEN_OPTS="-Dorg.slf4j.simpleLogger.defaultLogLevel=warn --batch-mode"
    - PATH=opt/atlassian-plugin-sdk/bin:opt/atlassian-plugin-sdk/apache-maven-*/bin:$PATH
addons:
  firefox: latest
cache:
  directories:
    - $HOME/build/sknopp/bamboo-chuck-norris-plugin/opt/atlassian-plugin-sdk
before_install:
  - wget -q https://marketplace.atlassian.com/download/plugins/atlassian-plugin-sdk-tgz
  - rm -rf opt download geckodriver
  - mkdir -p opt
  - mkdir -p download
  - tar -xzf *plugin-sdk* -C download
  - mv download/*plugin-sdk* opt/atlassian-plugin-sdk
  - chmod a+x opt/atlassian-plugin-sdk/bin/*
  - chmod a+x opt/atlassian-plugin-sdk/apache-maven-*/bin/*
  - atlas-version $MAVEN_OPTS
  - wget https://github.com/mozilla/geckodriver/releases/download/v0.26.0/geckodriver-v0.26.0-linux64.tar.gz
  - mkdir -p geckodriver
  - tar -xzf geckodriver-v0.26.0-linux64.tar.gz -C geckodriver
  - export PATH=$PATH:$PWD/geckodriver
install:
  - atlas-mvn integration-test $MAVEN_OPTS
  - atlas-mvn install $MAVEN_OPTS
script:
  - atlas-package $MAVEN_OPTS