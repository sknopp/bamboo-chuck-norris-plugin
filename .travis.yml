sudo: false
language: java
jdk:
- oraclejdk8
dist: trusty
env:
  global:
  - MOZ_HEADLESS=1
  - MAVEN_OPTS="-Dorg.slf4j.simpleLogger.defaultLogLevel=warn --batch-mode"
  - PATH=opt/atlassian-plugin-sdk/bin:opt/atlassian-plugin-sdk/apache-maven-*/bin:$PATH
addons:
  firefox: latest
cache:
  directories:
  - "$HOME/build/sknopp/bamboo-chuck-norris-plugin/opt/atlassian-plugin-sdk"
before_install:
- wget -q https://marketplace.atlassian.com/download/plugins/atlassian-plugin-sdk-tgz
- rm -rf opt download geckodriver
- mkdir -p opt
- mkdir -p download
- tar -xzf *plugin-sdk* -C download
- mv download/*plugin-sdk* opt/atlassian-plugin-sdk
- chmod a+x opt/atlassian-plugin-sdk/bin/*
- chmod a+x opt/atlassian-plugin-sdk/apache-maven-*/bin/*
- atlas-version $MAVEN_OPTS
- wget https://github.com/mozilla/geckodriver/releases/download/v0.26.0/geckodriver-v0.26.0-linux64.tar.gz
- mkdir -p geckodriver
- tar -xzf geckodriver-v0.26.0-linux64.tar.gz -C geckodriver
- export PATH=$PATH:$PWD/geckodriver
install:
- atlas-mvn integration-test $MAVEN_OPTS
- atlas-mvn install $MAVEN_OPTS
script:
- atlas-package $MAVEN_OPTS
deploy:
  provider: releases
  api_key:
    secure: KBuDIJZuDVFGF4sCU2pahhdtAzFaK1W10QLMNqfC5uxNhWaaaLTmyGWBF9YEevvjUaB0oO91fgSB2hzB+36xbNmdeW5GvAxqwfohJgc+GQbKIJvdzrPl9z1ZZlZz38mby3nsmqI/Wa2dufNeYqPSq0rGHi20300QA+T+lZJfqzsMe93erSOuZPBG8uQYCZSgk2HroOy0oERskfSp9gmKaKyeaUGPgZpHOXKFCGFY/ZkySzkEJc8goopXKPDigRiVSIc8cjKbDWmDTx2D3Snfb/4Cfe1yEUOVQ9UBku0m44C83+XEitOjTAPH/iWcWlIQ91UQ3nWzX4CcoXKQU+UomUfygv5pTEEvrcoB5SEc6ikl1rsYjp9cgT8xtYvd4XUZDukfGClIKrGvaudBcdak9QjJzRPnhu2NIttgjRUor0cv8QfuN4ObX1Tmvbw68QwF53AIn3Twd+wT5uDWem5qD5QsEDKMbKm/FroCV9ifaS87BAzUcyUnX5E0nmGScAsGxdwUj8RS/2dIoAwyiv3mGzXePEog6b0DMGZjaXM4wkqEG3Wyy6I11FEDEETfxO5tXF3R2zgNb7f+thrFCzs5rPvzul3f7ZYhtbiTVts7/xH8lFGWGZlfvFkXQD92+kIh8mckcEkfvr3kUA1DQJVACLneBztgXw9sKPWZrs2SUfo=
  file: target/chucknorris-1.0.0.jar
  skip_cleanup: true
  on:
    tags: true
    repo: sknopp/bamboo-chuck-norris-plugin
