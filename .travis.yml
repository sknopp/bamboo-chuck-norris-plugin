language: java
jdk:
- oraclejdk8
dist: trusty
env:
  global:
  - MOZ_HEADLESS=1
  - MAVEN_OPTS="-Dorg.slf4j.simpleLogger.defaultLogLevel=warn --batch-mode"
  - PATH=opt/atlassian-plugin-sdk/bin:opt/atlassian-plugin-sdk/apache-maven-*/bin:$PATH
addons:
  firefox: latest
cache:
  directories:
  - "$HOME/build/sknopp/bamboo-chuck-norris-plugin/opt/atlassian-plugin-sdk"
before_install:
- wget -q https://marketplace.atlassian.com/download/plugins/atlassian-plugin-sdk-tgz
- rm -rf opt download geckodriver
- mkdir -p opt
- mkdir -p download
- tar -xzf *plugin-sdk* -C download
- mv download/*plugin-sdk* opt/atlassian-plugin-sdk
- chmod a+x opt/atlassian-plugin-sdk/bin/*
- chmod a+x opt/atlassian-plugin-sdk/apache-maven-*/bin/*
- atlas-version $MAVEN_OPTS
- wget https://github.com/mozilla/geckodriver/releases/download/v0.26.0/geckodriver-v0.26.0-linux64.tar.gz
- mkdir -p geckodriver
- tar -xzf geckodriver-v0.26.0-linux64.tar.gz -C geckodriver
- export PATH=$PATH:$PWD/geckodriver
install:
- atlas-mvn integration-test $MAVEN_OPTS
- atlas-mvn install $MAVEN_OPTS
script:
- atlas-package $MAVEN_OPTS
deploy:
  provider: releases
  api_key:
    secure: a4UE8zW6SEWgD3PmNZ5SI7q6bGt12g/v05zysyHTrD4h9N2ri0W6RqONfWR0+tZ7iyy7Yxy/ZkVWZcbuiHQ0o8dAR2rVI4ly+2rc7pD/Fe5etxKh2xGbvcmsywoKPiEGIGLwkY46h2wJ4t3R32OwEPG9P8e+VdK+dQcN/p65BvSHegqQ7g/lCNhE2NXB+sdPRLGs99o3qm+r8NS/YWVxI48oxwNHtMBtyUVKF5FKyV4E/57gZEN8w89xuTMHaoiAoC7rxrGYxjGX/uA8NMAKPifXPSNLdXz9ERoQ5fGwYJIw4Aj3tcTYkmpZDiEIoECrHmjUl7/734sb91rSLz8fgHE0f7kTWDxWS6gGGUfipH77QD26yNiyh3dDRoyn+soQFqrAtHaZMTXznAVBaapqFNRf7akH+OhIMbtuAK1tKIdcDvD82lu9jBiE4F4PgLQrbNZWlL+/6/GoM9n0SboFSatsd+mpXeP1Psi6CORBnie33RnPN2clPnXBI8bdAaWBY45AAZ0clASFKDUuBk0jUGDZ+3ZtTSaUrcit1xT7780WT/2+Uehe9Fq6TPcyevgEaMNoJYL0BjE1LQPdiSuDWG8rn+9AasEAqYAteCyHBAxtmYUyoyOtklIPQ0UsDxn+tagvOQnv4AFsubYFIsR/3Ygh+4FPQJcyD8jvKeWwWt8=
  file: target/chucknorris-1.0.0.jar
  skip_cleanup: true
  on:
    tags: true
    repo: sknopp/bamboo-chuck-norris-plugin
